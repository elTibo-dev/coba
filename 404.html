<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cob√° - Tu Cafeter√≠a</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fff8f0;
      color: #4b2e2e;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    .container {
      background: white;
      max-width: 400px;
      margin: 50px auto;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    button {
      background: #c18f6a;
      border: none;
      color: white;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #a26f44;
    }
    input {
      padding: 10px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid #aaa;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Bienvenido a Cob√° ‚òï</h1>
    <p id="nombre">Cargando...</p>
    <p id="visitas"></p>
	<p id="ultima"></p>
	<p id="historial"></p>

    <!-- Bot√≥n discreto para mostrar input de PIN -->
    <button onclick="mostrarPinInput()">‚ãÆ</button>

    <!-- Campo de PIN -->
    <div id="pinDiv" style="display:none; margin-top: 10px;">
      <input 
        type="password" 
        inputmode="numeric" 
        pattern="[0-9]*" 
        id="pinInput" 
        placeholder="PIN staff" />
      <button onclick="validarPin()">Validar</button>
    </div>

    <!-- Bot√≥n para registrar visita -->
    <button id="registrarBtn" style="display:none; margin-top: 15px;" onclick="registrarVisita()">Registrar visita ‚òï</button>
  </div>

  <!-- Librer√≠a para SHA-256 -->
  <script src="https://cdn.jsdelivr.net/npm/js-sha256@0.9.0/src/sha256.min.js"></script>
  <script>
  const uid = window.location.pathname.split("/").pop();
  const scriptURL = "https://script.google.com/macros/s/AKfycbzos6PbzoLKore37cq5tq-L4MieHHCICheseEliPlQ62-uhRhyFnUg2fNMv7Zndfgi-/exec?uid=" + uid;

  async function cargarDatos() {
    try {
      const res = await fetch(scriptURL);
      const data = await res.json();

      if (data.status === "ok") {
        document.getElementById("nombre").innerText = ¬°Hola ${data.nombre || 'invitado'}!;
        document.getElementById("visitas").innerText = Visitas: ${data.visitas};
        document.getElementById("ultima").innerText = √öltima visita: ${data.ultima || "sin registro"};
        document.getElementById("historial").innerText = Historial: ${data.historial || "sin visitas a√∫n"};
      } else {
        document.getElementById("nombre").innerText = "UID no encontrado üò•";
      }
    } catch (e) {
      document.getElementById("nombre").innerText = "Error cargando datos";
    }
  }

  async function registrarVisita() {
    try {
      const res = await fetch(scriptURL + "&registrar=1");
      const data = await res.json();

      if (data.status === "ok") {
        alert("Visita registrada con √©xito ‚òï‚ú®");
        document.getElementById("visitas").innerText = Visitas: ${data.visitas};
        document.getElementById("ultima").innerText = √öltima visita: ${data.ultima};
        document.getElementById("historial").innerText = Historial: ${data.historial};
      } else {
        alert("No se pudo registrar la visita.");
      }
    } catch (e) {
      alert("Error de conexi√≥n.");
    }
  }

  function mostrarPinInput() {
    document.getElementById("pinDiv").style.display = "block";
  }

  function validarPin() {
    const pin = document.getElementById("pinInput").value;
    const hashCorrecto = "db6fa5cc1dfc7f5ab979e2d37ab8c1a0b176469d127a8444cbf3c5e2bd56705b";
    const hashIngresado = sha256(pin);

    if (hashIngresado === hashCorrecto) {
      document.getElementById("registrarBtn").style.display = "inline-block";
      alert("Modo staff activado üòé");
    } else {
      alert("PIN incorrecto ‚ùå");
    }
  }

  cargarDatos();
</script>
</body>
</html>